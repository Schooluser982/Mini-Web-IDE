<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini Web IDE</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material-darker.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/eclipse.min.css">

<style>
:root {
  --bg:#1e1e1e;
  --text:#fff;
  --panel-bg:#252526;
  --divider:#444;
  --devtools-height:300px;
}
body.light {
  --bg:#fff;
  --text:#000;
  --panel-bg:#f3f3f3;
  --divider:#ccc;
}
*{box-sizing:border-box}
body{
  margin:0;
  height:100vh;
  display:flex;
  flex-direction:column;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,sans-serif;
  overflow:hidden;
}
header{
  padding:8px 12px;
  display:flex;
  align-items:center;
  gap:8px;
  background:#00000040;
  border-bottom:1px solid #00000060;
}
header button{
  padding:4px 10px;
  border-radius:4px;
  border:1px solid #555;
  background:#333;
  color:#fff;
  cursor:pointer;
  font-size:13px;
}
body.light header button{
  background:#e0e0e0;
  color:#000;
  border-color:#aaa;
}
#container{flex:1;display:flex;min-height:0}
#left{width:50%;display:flex;flex-direction:column;background:var(--panel-bg)}
#tabs{display:flex;background:#00000030;border-bottom:1px solid #00000040}
.tab{flex:1;padding:6px;text-align:center;cursor:pointer}
.tab.active{background:#00000060;font-weight:600}
#editors{flex:1;position:relative}
.editor-wrapper{position:absolute;inset:0;display:none}
.editor-wrapper.active{display:block}
.CodeMirror{height:100%;font-size:13px}
#divider{width:6px;cursor:ew-resize;background:var(--divider)}
#right{flex:1;display:flex;flex-direction:column;position:relative}
#preview{flex:1;border:none;background:white}
#console{
  height:100px;
  background:#111;
  color:#0f0;
  font-family:monospace;
  font-size:12px;
  padding:6px;
  overflow:auto;
  border-top:1px solid #333;
}
#devtools{
  position:absolute;
  left:0;right:0;
  bottom:-300px;
  height:300px;
  background:#111;
  border-top:2px solid #333;
  transition:bottom .3s;
}
#devtools.open{bottom:0}
#devtools-tabs{display:flex;background:#222}
.dt-tab{padding:6px 10px;cursor:pointer;font-size:12px}
.dt-tab.active{background:#444;font-weight:bold}
.dt-panel{display:none;white-space:pre-wrap;font-family:monospace;font-size:12px;padding:6px}
.dt-panel.active{display:block}
.__inspect-highlight{outline:2px solid red}
</style>
</head>

<body>

<header>
  <button id="runBtn">Run â–¶</button>
  <button id="saveBtn">Save</button>
  <button id="loadBtn">Load</button>
  <input type="file" id="fileInput" hidden>
  <button id="themeBtn">Toggle Theme</button>
  <button id="devtoolsBtn">DevTools</button>
  <span style="margin-left:auto;font-size:12px;opacity:.7">Mini Web IDE</span>
</header>

<div id="container">
  <div id="left">
    <div id="tabs">
      <div class="tab active" data-t="html">HTML</div>
      <div class="tab" data-t="css">CSS</div>
      <div class="tab" data-t="js">JS</div>
    </div>
    <div id="editors">
      <div class="editor-wrapper active" id="html-w">
        <textarea id="htmlEditor">
<h1>Hello!</h1>
<p>Edit HTML, CSS, and JS, then click Run.</p>
        </textarea>
      </div>
      <div class="editor-wrapper" id="css-w">
        <textarea id="cssEditor">
body {
  font-family: sans-serif;
  padding: 20px;
}
        </textarea>
      </div>
      <div class="editor-wrapper" id="js-w">
        <textarea id="jsEditor">
console.log("Hello from js!");
        </textarea>
      </div>
    </div>
  </div>

  <div id="divider"></div>

  <div id="right">
    <iframe id="preview"></iframe>
    <div id="console">Hello from js!</div>

    <div id="devtools">
      <div id="devtools-tabs">
        <div class="dt-tab active" data-dt="elements">Elements</div>
        <div class="dt-tab" data-dt="styles">Styles</div>
        <div class="dt-tab" data-dt="source">Source</div>
      </div>
      <pre id="elements" class="dt-panel active"></pre>
      <pre id="styles" class="dt-panel"></pre>
      <pre id="source" class="dt-panel"></pre>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/css/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>

<script>
let dark=true;
const htmlCM=CodeMirror.fromTextArea(htmlEditor,{mode:"xml",lineNumbers:true,theme:"material-darker"});
const cssCM=CodeMirror.fromTextArea(cssEditor,{mode:"css",lineNumbers:true,theme:"material-darker"});
const jsCM=CodeMirror.fromTextArea(jsEditor,{mode:"javascript",lineNumbers:true,theme:"material-darker"});

themeBtn.onclick=()=>{
  dark=!dark;
  document.body.classList.toggle("light",!dark);
  const t=dark?"material-darker":"eclipse";
  htmlCM.setOption("theme",t);
  cssCM.setOption("theme",t);
  jsCM.setOption("theme",t);
};

document.querySelectorAll(".tab").forEach(t=>{
  t.onclick=()=>{
    document.querySelectorAll(".tab,.editor-wrapper").forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    document.getElementById(t.dataset.t+"-w").classList.add("active");
    htmlCM.refresh();cssCM.refresh();jsCM.refresh();
  };
});

function openInNewTab(doc){
  const w=window.open("about:blank");
  if(!w) return alert("Popup blocked");
  w.document.write(doc);
  w.document.close();
}

function runCode(target="preview"){
  consoleDiv.textContent="Hello from js!";
  const doc=`
<!DOCTYPE html>
<html>
<head><style>${cssCM.getValue()}</style></head>
<body>
${htmlCM.getValue()}
<script>${jsCM.getValue()}<\/script>
</body>
</html>`;
  target==="newtab"?openInNewTab(doc):preview.srcdoc=doc;
}

runBtn.onclick=()=>{
  confirm("OK = Preview\nCancel = New Tab")
    ? runCode("preview")
    : runCode("newtab");
};

devtoolsBtn.onclick=()=>devtools.classList.toggle("open");

const consoleDiv=document.getElementById("console");

saveBtn.onclick=()=>{
  const blob=new Blob([JSON.stringify({
    html:htmlCM.getValue(),
    css:cssCM.getValue(),
    js:jsCM.getValue()
  },null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="project.txt";
  a.click();
};

loadBtn.onclick=()=>fileInput.click();
fileInput.onchange=e=>{
  const r=new FileReader();
  r.onload=()=>{
    const d=JSON.parse(r.result);
    htmlCM.setValue(d.html||"");
    cssCM.setValue(d.css||"");
    jsCM.setValue(d.js||"");
  };
  r.readAsText(e.target.files[0]);
};

runCode();
</script>

</body>
</html>
